## Reproducing Section 6.2: Fig 3, Tree Depths

Navigation: [Table of contents], [Previous section], [Next section]

[Table of contents]: 1-intro.md#index
[Previous section]: 3-section-6.1.md
[Next section]: 5-section-6.3.md

DPU constructs and maintains the unfolding of the program using a
data structure based on trees. These allow the efficient implementation of all
operations of Algorithm 1 in the paper, including, mainly, queries to determine
if two events are related by a relation of **causality** or **conflict**.

For every POSIX mutex and every thread of the program under analysis, the data
structure maintains one tree. In Section 6.2 of the paper we evaluate these
trees and make the following claims:

1. The average node depth is 22.7.
2. 80% of the tree nodes have a maximum depth of less than 8 nodes.
3. 90% of the tree nodes have a maximum depth of less than 16 nodes.
4. 92% of the causality queries are for nodes separated by a distance of 1 to 4.
5. 70% of the causality queries are for nodes separated by a distance of 1 to 2.
6. 82% of the conflict queries are for nodes separated by a distance of 1 to 4.

Additionally, Figure 3 of the paper contains:

7. Plots of the average-node-depth and the maximal-tree-depth.
8. Two histograms showing the frequency (axe Y) at which queries are made to the
   trees for nodes with a given depth (axe X).

Here we provide the data that supports these claims/figures as well as
instructions how to generate the data.

### Benchmarks

To prove this claims we use the following bencH

- LIST with instactiation of parameters

### The Data
THe resulting data is available in the spreadsheet file XXX.

There are four tabs:

- 1. Explain columns. Show hwo the data proves the claims.

- 2

3

4

### Generating the Data Above

- DPU needs to be compiled with an special option XXX to output additional data.
  A config.mk is provided, and also the binaries, available HERE.
  The binaries are available in `sec6.2*/dpu-stats-dist`. They ha bee obtained
  using the `config.mk` in that folder. The difference is that we compiled
  the tool with `CONFIG_DETAILED_STATS` enabled.
- making sure we have a good compilation:

```sh
cesar@polaris:~/x/devel/dpu$ ./dist/bin/dpu -V | grep detailed-stats
Features: +detailed-stats 
```

- optional: explaining the output in 1 run

To generate the data you go to the root and type

```sh
cd $ROOT
make sec6.2-gen-csv
```

That in turn will call the script `scripts/run-sec6.2-gen-csv.sh`, which
generates logs in folder XX. Logs from a previous execution of the script are
provide in `THIS FOLDER`.

The script works in X stages:

1. Preprocess benchmarks:

 Snipet

2. Parse the logs and generate CSV files containing statistical data about the
   depths of nodes in the trees. This is done in the function
   `parse_logs_into_tree_depth_csv`. Three files are generated:

   tree-stats.csv
   This contains the data that we have manually copied to the first tab of the
   spreadsheet (title "Tree-depth raw data"). The reviewer can check that the
   contents of the file and the spreadsheet are the same.

   These are the first 15 lines of the file:

   FIXME

   tree-variable-stats.csv:

   This file and the next one are generated by selecting those lines in the
   above file that correspond to variables. This is done with a simple `grep`
   command in `parse_logs_into_tree_depth_csv`.

   The contents of this file are the 1st table in the 2nd TAB.

   The first 15 lines:
   FIXME


   tree-thread-stats.csv:
   This file results from taking the lines of the first CSV for the threads. It
   is the 2nd table in the 2nd tab.


   First 15 lines:

   FIXME
   
3. Generation of a histograms for causality and conflict queries

This is done in the functions `generate_histogram_causality_diff`
and `generate_histogram_conflict_diff`. These function parse the logs again
searching for lines like these generated by DPU:

example

The data extracted is then put in the file /tmp/pairs.txt and a small python
script aggregates the counts from multiple benchmarks.

Two files are generated, `histogram-conflict.csv`, whose contents are identical
to the 3rd tab of the spreadhseet. Here are the first 15 lines:

FIXME

And the file `histogram-conflict.csv`, whose contents are in the 4th tab. First
lines:

FIXME

